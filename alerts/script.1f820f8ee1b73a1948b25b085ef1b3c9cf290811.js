function ready(){const t=function(){let t=localStorage.getItem("darkMode");return null===t?(t=window.matchMedia&&!!window.matchMedia("(prefers-color-scheme: dark)").matches,localStorage.setItem("darkMode",t)):t=JSON.parse(t),t?(console.log("dark mode is on"),document.documentElement.classList.remove("light")):(console.log("dark mode is off"),document.documentElement.classList.add("light")),t}(),e={dailyDuration:{alerts:[],meta:{},loaded:!1,updatedAt:null,error:!1},active:{alerts:[],meta:{},loaded:!1,updatedAt:null},timer:30,errorAttempts:3,screen:"map",os:(navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?"ios":navigator.userAgent.match(/Android/i)?"android":"desktop")||"desktop",darkMode:t,scaled:!1,online:void 0===navigator.onLine||navigator.onLine};function a(){l.darkMode=!l.darkMode,localStorage.setItem("darkMode",l.darkMode),document.documentElement.classList.toggle("light"),d()}let n,o;["127.0.0.1","localhost"].includes(location.hostname)?n="/":(n="https://war-api.ukrzen.in.ua/alerts/",o="https://war.ukrzen.in.ua/alerts/");const i=function(t,e){return e||(e=new Date),new Date(e).getTime()-new Date(t).getTime()},r=function(){document.querySelectorAll('[data-oblast]:not([data-oblast="Автономна Республіка Крим"])').forEach(t=>{let a,n;e.darkMode?(a="rgba(25, 38, 56,0.9)",n="rgba(255, 255, 255, 0.2)"):(a="#e9ddce",n="#c2b9ad"),t.setAttribute("fill",a),t.setAttribute("stroke",n),t.setAttribute("fill-opacity","0.9"),t.setAttribute("class","")})},d=function(){fetch(n+"api/alerts/active.json").then(t=>t.json()).then(t=>{const a=e.active.meta.last_updated_at!==t.meta.last_updated_at&&void 0!==e.active.meta.last_updated_at;!function(t){t&&t.forEach(t=>{t.duration=i(t.started_at,t.finished_at),t.fresh=i(t.updated_at)<6e4})}(t.alerts),e.active.alerts=t.alerts.reverse(),e.active.meta=t.meta,e.active.updatedAt=new Date,e.timer=a?10:25,e.errorAttempts=3,r(),["oblast","raion","city","hromada"].forEach(e=>{t.alerts.filter(t=>t.location_type===e).forEach(t=>(function(t,e="0.3",a=null){if(t.finished_at)a="#F6E7D8";else{a="rgba(230,25,25,0.4)";const n=i(t.started_at,t.finished_at)/6e4,o=240;let r=1;n<o&&(r=n/o),e=1-.3*r}let n=t.location_type,o=t.location_title;"hromada"===t.location_type&&(n="raion",o=t.location_raion),document.querySelectorAll("[data-"+n+'="'+o+'"]').forEach(t=>{t.setAttribute("fill",a),t.setAttribute("fill-opacity",e),t.setAttribute("class","active")})})(t))}),requestAnimationFrame(()=>{e.active.loaded=!0})}).catch(t=>{console.error(t),e.errorAttempts-=1,e.timer=30,0===e.errorAttempts&&clearInterval(c)})},l=new Vue({el:"#app",data:e,methods:{formatDate:function(t,e=!1){if(t){if("Date"!=typeof t&&(t=new Date(t)),result=t.toLocaleDateString("uk-UA",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/Kiev"}),e){const e=864e5;result=`${result} (${Math.round((t.getTime()-new Date(2022,1,24).getTime())/e)} день);`}return result}return""},fetchDailyDuration:function(){fetch(n+"api/stats/daily_duration").then(t=>t.json()).then(t=>{e.active.meta.last_updated_at!==t.meta.last_updated_at&&e.active.meta.last_updated_at,e.dailyDuration.data=t.data,e.dailyDuration.meta=t.meta,e.dailyDuration.updatedAt=new Date,e.dailyDuration.loaded=!0}).catch(t=>{e.dailyDuration.loaded=!0,e.dailyDuration.error=!0})},toggleDarkMode:a,formatDuration(t,e){function a(t,e){return 0===e?"":`${e} ${t}`}let n=t/1e3;const o=parseInt(n/60/60),i=parseInt(n/60%60);return`${a("год.",o)} ${a("хв.",i)}`}}}),c=setInterval(function(){void 0!==e.timer&&(e.timer>0?e.timer-=1:document.hidden||!1===navigator.onLine||d())},1e3);requestAnimationFrame(function(){fetch(o+document.querySelector('[name="map:url"]').getAttribute("content")).then(t=>t.text()).then(t=>{r(),document.getElementById("map").innerHTML=t,d()}).catch(console.error.bind(console))}),document.addEventListener("visibilitychange",function(t){document.hidden||(e.timer=0)}),window.addEventListener("offline",function(t){e.online=!1}),window.addEventListener("online",function(t){e.online=!0}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{e.darkMode!==!!t.matches&&a()})}document.addEventListener("DOMContentLoaded",ready);